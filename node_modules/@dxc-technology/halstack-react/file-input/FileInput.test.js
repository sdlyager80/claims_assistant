"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _react = _interopRequireDefault(require("react"));

var _react2 = require("@testing-library/react");

var _userEvent = _interopRequireDefault(require("@testing-library/user-event"));

var _FileInput = _interopRequireDefault(require("./FileInput"));

describe("FileInput component tests", function () {
  var file1 = new File(["file1"], "file1.png", {
    type: "image/png"
  });
  var file2 = new File(["file2"], "file2.txt", {
    type: "text/plain"
  });
  var allFiles = [{
    file: file1
  }, {
    error: "Error message",
    file: file2
  }];
  test("Renders with correct labels and helper text in file mode", function () {
    var _render = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
      label: "File input label",
      helperText: "File input helper text",
      buttonLabel: "Choose files"
    })),
        getByText = _render.getByText;

    expect(getByText("File input label")).toBeTruthy();
    expect(getByText("File input helper text")).toBeTruthy();
    expect(getByText("Choose files")).toBeTruthy();
  });
  test("Renders with correct button label in file mode", function () {
    var _render2 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
      label: "File input label",
      helperText: "File input helper text"
    })),
        getByText = _render2.getByText;

    expect(getByText("Select files")).toBeTruthy();
  });
  test("Renders with correct button label in file mode and single file selection", function () {
    var _render3 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
      label: "File input label",
      helperText: "File input helper text",
      multiple: false
    })),
        getByText = _render3.getByText;

    expect(getByText("Select file")).toBeTruthy();
  });
  test("Renders with correct labels in filedrop mode", function () {
    var _render4 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
      label: "File input label",
      helperText: "File input helper text",
      mode: "filedrop"
    })),
        getByText = _render4.getByText;

    expect(getByText("Select")).toBeTruthy();
    expect(getByText("or drop files")).toBeTruthy();
  });
  test("Renders with correct labels in filedrop mode and single file selection", function () {
    var _render5 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
      label: "File input label",
      helperText: "File input helper text",
      mode: "filedrop",
      multiple: false
    })),
        getByText = _render5.getByText;

    expect(getByText("Select")).toBeTruthy();
    expect(getByText("or drop a file")).toBeTruthy();
  });
  test("Renders with correct custom labels in filedrop mode", function () {
    var _render6 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
      label: "File input label",
      helperText: "File input helper text",
      mode: "filedrop",
      buttonLabel: "Choose",
      dropAreaLabel: "(or drop the files)"
    })),
        getByText = _render6.getByText;

    expect(getByText("Choose")).toBeTruthy();
    expect(getByText("(or drop the files)")).toBeTruthy();
  });
  test("Renders with correct labels in dropzone mode", function () {
    var _render7 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
      label: "File input label",
      helperText: "File input helper text",
      mode: "dropzone"
    })),
        getByText = _render7.getByText;

    expect(getByText("Select")).toBeTruthy();
    expect(getByText("or drop files")).toBeTruthy();
  });
  test("Renders with correct labels in dropzone mode and single file selection", function () {
    var _render8 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
      label: "File input label",
      helperText: "File input helper text",
      mode: "dropzone",
      multiple: false
    })),
        getByText = _render8.getByText;

    expect(getByText("Select")).toBeTruthy();
    expect(getByText("or drop a file")).toBeTruthy();
  });
  test("Renders with correct custom labels in dropzone mode", function () {
    var _render9 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
      label: "File input label",
      helperText: "File input helper text",
      mode: "dropzone",
      buttonLabel: "Choose",
      dropAreaLabel: "(or drop the files)"
    })),
        getByText = _render9.getByText;

    expect(getByText("Choose")).toBeTruthy();
    expect(getByText("(or drop the files)")).toBeTruthy();
  });
  test("Disabled file input", function () {
    var _render10 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
      label: "File input label",
      helperText: "File input helper text",
      disabled: true
    })),
        getByText = _render10.getByText,
        getByRole = _render10.getByRole;

    expect(getByText("Select files")).toBeTruthy();
    var button = getByRole("button");
    expect(button.disabled).toBeTruthy();
  });
  test("Renders file items passed in value when multiple file input", /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
    var callbackFile, _render11, getByText;

    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            callbackFile = jest.fn();
            _render11 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
              label: "File input label",
              helperText: "File input helper text",
              value: allFiles,
              callbackFile: callbackFile
            })), getByText = _render11.getByText;
            _context.next = 4;
            return (0, _react2.waitFor)(function () {
              expect(getByText("file1.png")).toBeTruthy();
              expect(getByText("file2.txt")).toBeTruthy();
              expect(getByText("Error message")).toBeTruthy();
            });

          case 4:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  })));
  test("Renders file items when single file input", /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
    var callbackFile, _render12, getByText;

    return _regenerator["default"].wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            callbackFile = jest.fn();
            _render12 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
              label: "File input label",
              helperText: "File input helper text",
              multiple: false,
              value: allFiles,
              callbackFile: callbackFile
            })), getByText = _render12.getByText;
            _context2.next = 4;
            return (0, _react2.waitFor)(function () {
              expect(getByText("file1.png")).toBeTruthy();
              expect(getByText("file2.txt")).toBeTruthy();
              expect(getByText("Error message")).toBeTruthy();
            });

          case 4:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  })));
  test("Add file item when single file input", /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3() {
    var newFile, callbackFile, _render13, getByText, getByLabelText;

    return _regenerator["default"].wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            newFile = new File(["newFile"], "newFile.pdf", {
              type: "pdf"
            });
            callbackFile = jest.fn();
            _render13 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
              label: "File input label",
              helperText: "File input helper text",
              value: allFiles,
              callbackFile: callbackFile,
              multiple: false
            })), getByText = _render13.getByText, getByLabelText = _render13.getByLabelText;
            _context3.next = 5;
            return (0, _react2.waitFor)(function () {
              expect(getByText("file1.png")).toBeTruthy();
              expect(getByText("file2.txt")).toBeTruthy();
              expect(getByText("Error message")).toBeTruthy();
              var inputFile = getByLabelText("File input label", {
                hidden: true
              });

              _react2.fireEvent.change(inputFile, {
                target: {
                  files: [newFile]
                }
              });

              expect(callbackFile).toHaveBeenCalledWith([{
                file: newFile,
                preview: /*#__PURE__*/_react["default"].createElement("svg", {
                  xmlns: "http://www.w3.org/2000/svg",
                  width: "24",
                  height: "24",
                  viewBox: "0 0 24 24",
                  fill: "currentColor"
                }, /*#__PURE__*/_react["default"].createElement("path", {
                  fill: "none",
                  d: "M0 0h24v24H0V0z"
                }), /*#__PURE__*/_react["default"].createElement("path", {
                  d: "M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"
                }))
              }]);
            });

          case 5:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3);
  })));
  test("Renders file items and delete one file", /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4() {
    var callbackFile, _render14, getByText, getAllByRole;

    return _regenerator["default"].wrap(function _callee4$(_context4) {
      while (1) {
        switch (_context4.prev = _context4.next) {
          case 0:
            callbackFile = jest.fn();
            _render14 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
              label: "File input label",
              helperText: "File input helper text",
              value: allFiles,
              callbackFile: callbackFile
            })), getByText = _render14.getByText, getAllByRole = _render14.getAllByRole;
            _context4.next = 4;
            return (0, _react2.waitFor)(function () {
              expect(getByText("file1.png")).toBeTruthy();
              expect(getByText("file2.txt")).toBeTruthy();
              expect(getByText("Error message")).toBeTruthy();
              var removeBtn = getAllByRole("button")[1];

              _userEvent["default"].click(removeBtn);

              expect(callbackFile).toHaveBeenCalledWith([{
                error: "Error message",
                file: file2,
                preview: /*#__PURE__*/_react["default"].createElement("svg", {
                  xmlns: "http://www.w3.org/2000/svg",
                  width: "24",
                  height: "24",
                  viewBox: "0 0 24 24",
                  fill: "currentColor"
                }, /*#__PURE__*/_react["default"].createElement("path", {
                  fill: "none",
                  d: "M0 0h24v24H0V0z"
                }), /*#__PURE__*/_react["default"].createElement("path", {
                  d: "M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"
                }))
              }]);
            });

          case 4:
          case "end":
            return _context4.stop();
        }
      }
    }, _callee4);
  })));
  test("CallbackFile is correctly called", /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5() {
    var newFile, callbackFile, _render15, getByLabelText;

    return _regenerator["default"].wrap(function _callee5$(_context5) {
      while (1) {
        switch (_context5.prev = _context5.next) {
          case 0:
            newFile = new File(["newFile"], "newFile.pdf", {
              type: "pdf"
            });
            callbackFile = jest.fn();
            _render15 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
              label: "File input label",
              helperText: "File input helper text",
              value: allFiles,
              callbackFile: callbackFile
            })), getByLabelText = _render15.getByLabelText;
            _context5.next = 5;
            return (0, _react2.waitFor)(function () {
              var inputFile = getByLabelText("File input label", {
                hidden: true
              });

              _react2.fireEvent.change(inputFile, {
                target: {
                  files: [newFile]
                }
              });

              expect(callbackFile).toHaveBeenCalledWith([{
                file: file1,
                preview: "data:image/png;base64,ZmlsZTE="
              }, {
                error: "Error message",
                file: file2,
                preview: /*#__PURE__*/_react["default"].createElement("svg", {
                  xmlns: "http://www.w3.org/2000/svg",
                  width: "24",
                  height: "24",
                  viewBox: "0 0 24 24",
                  fill: "currentColor"
                }, /*#__PURE__*/_react["default"].createElement("path", {
                  fill: "none",
                  d: "M0 0h24v24H0V0z"
                }), /*#__PURE__*/_react["default"].createElement("path", {
                  d: "M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"
                }))
              }, {
                error: undefined,
                file: newFile,
                preview: /*#__PURE__*/_react["default"].createElement("svg", {
                  xmlns: "http://www.w3.org/2000/svg",
                  width: "24",
                  height: "24",
                  viewBox: "0 0 24 24",
                  fill: "currentColor"
                }, /*#__PURE__*/_react["default"].createElement("path", {
                  fill: "none",
                  d: "M0 0h24v24H0V0z"
                }), /*#__PURE__*/_react["default"].createElement("path", {
                  d: "M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"
                }))
              }]);
            });

          case 5:
          case "end":
            return _context5.stop();
        }
      }
    }, _callee5);
  })));
  test("Callback called correctly when a file size does not comply minSize or maxSize", /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6() {
    var newFile, callbackFile, _render16, getByText, getByLabelText;

    return _regenerator["default"].wrap(function _callee6$(_context6) {
      while (1) {
        switch (_context6.prev = _context6.next) {
          case 0:
            newFile = new File(["newFile"], "newFile.pdf", {
              type: "pdf"
            });
            callbackFile = jest.fn();
            _render16 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_FileInput["default"], {
              label: "File input label",
              helperText: "File input helper text",
              minSize: 1000,
              maxSize: 20000,
              value: allFiles,
              callbackFile: callbackFile
            })), getByText = _render16.getByText, getByLabelText = _render16.getByLabelText;
            _context6.next = 5;
            return (0, _react2.waitFor)(function () {
              expect(getByText("file1.png")).toBeTruthy();
              expect(getByText("file2.txt")).toBeTruthy();
              expect(getByText("Error message")).toBeTruthy();
              var inputFile = getByLabelText("File input label", {
                hidden: true
              });

              _react2.fireEvent.change(inputFile, {
                target: {
                  files: [newFile]
                }
              });

              expect(callbackFile).toHaveBeenCalledWith([{
                file: file1,
                preview: "data:image/png;base64,ZmlsZTE="
              }, {
                error: "Error message",
                file: file2,
                preview: /*#__PURE__*/_react["default"].createElement("svg", {
                  xmlns: "http://www.w3.org/2000/svg",
                  width: "24",
                  height: "24",
                  viewBox: "0 0 24 24",
                  fill: "currentColor"
                }, /*#__PURE__*/_react["default"].createElement("path", {
                  fill: "none",
                  d: "M0 0h24v24H0V0z"
                }), /*#__PURE__*/_react["default"].createElement("path", {
                  d: "M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"
                }))
              }, {
                error: "File size must be greater than min size.",
                file: newFile,
                preview: /*#__PURE__*/_react["default"].createElement("svg", {
                  xmlns: "http://www.w3.org/2000/svg",
                  width: "24",
                  height: "24",
                  viewBox: "0 0 24 24",
                  fill: "currentColor"
                }, /*#__PURE__*/_react["default"].createElement("path", {
                  fill: "none",
                  d: "M0 0h24v24H0V0z"
                }), /*#__PURE__*/_react["default"].createElement("path", {
                  d: "M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"
                }))
              }]);
            });

          case 5:
          case "end":
            return _context6.stop();
        }
      }
    }, _callee6);
  })));
});